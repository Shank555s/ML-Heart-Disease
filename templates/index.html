<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Heart Disease Prediction</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>❤️ Heart Disease Prediction</h1>
        <form id="predict-form">
            <div class="grid">
                <div><label>Age</label><input type="number" name="age" required></div>
                <div><label>Sex (0=Female,1=Male)</label><input type="number" name="sex" min="0" max="1" required></div>
                <div><label>Chest Pain (0–3)</label><input type="number" name="cp" min="0" max="3" required></div>
                <div><label>Resting BP</label><input type="number" name="trestbps" required></div>
                <div><label>Cholesterol</label><input type="number" name="chol" required></div>
                <div><label>Fasting BS (0/1)</label><input type="number" name="fbs" min="0" max="1" required></div>
                <div><label>Rest ECG (0–2)</label><input type="number" name="restecg" min="0" max="2" required></div>
                <div><label>Max Heart Rate</label><input type="number" name="thalach" required></div>
                <div><label>Exercise Induced Angina (0/1)</label><input type="number" name="exang" min="0" max="1" required></div>
                <div><label>Oldpeak</label><input type="number" step="0.1" name="oldpeak" required></div>
                <div><label>Slope (0–2)</label><input type="number" name="slope" min="0" max="2" required></div>
                <div><label>Ca (0–3)</label><input type="number" name="ca" min="0" max="3" required></div>
                <div><label>Thal (0–2)</label><input type="number" name="thal" min="0" max="2" required></div>
            </div>
            <button type="submit">Predict</button>
        </form>
        <div id="result"></div>
    </div>

    <script>
        const form = document.getElementById("predict-form");
        const resultDiv = document.getElementById("result");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const data = {};
            formData.forEach((v, k) => data[k] = parseFloat(v));

            const payload = {
                columns: Object.keys(data),
                data: [Object.values(data)]
            };

            try {
                const res = await fetch("/predict", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify(payload)
                });

                const json = await res.json();

                if (json.prediction !== undefined) {
                    let pred = Array.isArray(json.prediction) ? json.prediction[0] : json.prediction;
                    let prob = Array.isArray(json.probability) ? json.probability[0] : json.probability;

                    resultDiv.innerHTML = `
                        <h2 class="fade-in">Prediction: <span class="${pred === 1 ? 'danger' : 'safe'}">
                        ${pred === 1 ? 'Possible Heart Disease Detected' : 'Risk of Heart Disease Is Low'}</span>
                        </h2>
                        <p>Probability: ${(prob * 100).toFixed(2)}%</p>
                    `;

                    // ✅ Now clears all fields correctly
                    form.reset();
                } 
                else if (json.error) {
                    resultDiv.innerHTML = `<h2 style="color:red">${json.error}</h2>`;
                } 
                else {
                    resultDiv.innerHTML = `<h2 style="color:red">Unexpected response from server.</h2>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<h2 style="color:red">Error: ${err.message}</h2>`;
            }
        });
    </script>
</body>
</html>
